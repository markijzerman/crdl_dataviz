<!DOCTYPE html>
<html>

<head>
<meta charset="utf-8">
<!-- Load c3.css -->
<link href="c3.css" rel="stylesheet">
<!-- Load d3.js and c3.js -->
<script src="https://d3js.org/d3.v3.min.js"></script>
<script src="c3.min.js"></script>
<script src="./papaparse.min.js"></script>
<script src="./jquery-3.3.1.min.js"></script>
</head>



<body>
<h1>CRDL LOG DETAILS</h1>

<div id="chart">

<script>
  var data;
 
 function handleFileSelect(evt) {
   var file = evt.target.files[0];

   Papa.parse(file, {
     header: true,
     dynamicTyping: true,
     complete: function(results) {
       // when loaded a csv file, put in arrays
       var lognr = [];
       var runTime = [];
       var connectionTime = [];
       var actualTouchTime = [];
       var amtOfTouches = [];
       var amtModeKeyPressed = [];
       var amtOfSessions = [];

       for (var i = 0; i < results.data.length; i++) {
         lognr.push(parseInt(results.data[i].lognr));
         runTime.push(parseInt(results.data[i].runTime));
         connectionTime.push(parseInt(results.data[i].connectionTime));
         actualTouchTime.push(parseInt(results.data[i].actualTouchTime));
         amtOfTouches.push(parseInt(results.data[i].amtOfTouches));
         amtModeKeyPressed.push(parseInt(results.data[i].amtModeKeyPressed));
         amtOfSessions.push(parseInt(results.data[i].amtOfSessions));
       }
       
       // console.log(lognr);
       // console.log(amtOfSessions);


        // function to calculate HH:MM:SS
    var toHHMMSS = (secs) => {
    var sec_num = parseInt(secs, 10)    
    var hours   = Math.floor(sec_num / 3600) % 24
    var minutes = Math.floor(sec_num / 60) % 60
    var seconds = sec_num % 60    
    return [hours,minutes,seconds]
        .map(v => v < 10 ? "0" + v : v)
        // .filter((v,i) => v !== "00" || i > 0)
        .join(":")
    }

    // print values to the html
    document.getElementById("amtOfTimesOn").innerHTML = Math.max(...lognr);
    document.getElementById("totalRuntime").innerHTML = toHHMMSS((runTime.reduce((a, b)=>a+b)));
    document.getElementById("totalConnectionTime").innerHTML = toHHMMSS((connectionTime.reduce((a, b)=>a+b)));
    document.getElementById("totalActualTouchTime").innerHTML = toHHMMSS((actualTouchTime.reduce((a, b)=>a+b)));
    document.getElementById("totalTouches").innerHTML = amtOfTouches.reduce((a, b)=>a+b);
    document.getElementById("totalSessions").innerHTML = amtOfSessions.reduce((a, b)=>a+b);




       // START MAKING CHART

    var chart = c3.generate({
    bindto: '#chart',

        data: {
            columns: [
                ['lognr', ...lognr], 
                ['runTime', ...runTime],
                ['connectionTime', ...connectionTime],
                ['actualTouchTime', ...actualTouchTime],
                ['amtOfTouches', ...amtOfTouches],
                ['amtModeKeyPressed', ...amtModeKeyPressed],
                ['amtOfSessions', ...amtOfSessions]
            ],
            type: 'bar'
        },

        axis: {
            x: 'lognr',
            groups:[['runTime','connectionTime', 'actualTouchTime'], ['amtOfSessions','amtModeKeyPressed']],
            hide:[['amtOfSessions','amtModeKeyPressed']],

            labels: {
                format: {
                    runTime: (function(num) {
                        var h = Math.floor( num / 3600 ); 
                        var m = Math.floor((num - h * 3600) / 60 ); 
                        var s = Math.floor(num - (h * 3600 + m * 60)); 
                        return ( h < 10 ? "0" + h : h ) + ":" + ( m < 10 ? "0" + m : m ) + ":" + ( s < 10 ? "0" + s : s );
                    })

                }
            }
        },



    axis: {
        x: {
        },
        y: {
            label: {
                text: 'time used',
                position: 'outer-middle'
            },
            tick: {
                format: (function(num) {
                    var h = Math.floor( num / 3600 ); 
                    var m = Math.floor((num - h * 3600) / 60 ); 
                    var s = num - (h * 3600 + m * 60); 
                    return ( h < 10 ? "0" + h : h ) + ":" + ( m < 10 ? "0" + m : m ) + ":" + ( s < 10 ? "0" + s : s );
                })
            }
        }
    },

    tooltip: {
        format: {
            
            title: function (d) {return 'Session ' + (d); },
        //     amtOfTouches: d3.format($),
        //     value: function(value, ratio, id) {
        //         var format = id === 'amtOfTouches' ? d3.format('$') : d3.format();
        //         return format(value);
        //     }

        }
    }






    
});
chart.data.names({runTime: 'Total time', connectionTime: 'Connection time', actualTouchTime:'Actual touch time', amtOfTouches:'Amount of touches', amtModeKeyPressed:'Amount of mode key pressed', amtOfSessions:'Amount of Sessions'});






     }
   });
 }



 $(document).ready(function(){
   $("#csv-file").change(handleFileSelect);
 });



</script>

<input type="file" id="csv-file" name="files"/>

</div>

<!-- Hide unwanted bar graphs -->
<style>
.c3-target-amtOfTouches {
  display: none;
}

.c3-target-amtModeKeyPressed {
  display: none;
}

.c3-target-amtOfSessions {
  display: none;
}
</style>
<p>CRDL has been on for </p><p id="amtOfTimesOn"></p><p> times since reset of the log.</p><br>
<p>It ran for a total of </p><p id="totalRuntime"></p><p>.</p><br>
<p>People shared a connection for </p><p id="totalConnectionTime"></p><p>.</p><br>
<p>Actual physical touch duration total was </p><p id="totalActualTouchTime"></p><p>.</p><br>
<p>People touched each other for </p><p id="totalTouches"></p><p> times.</p><br>
<p>In total there were </p><p id="totalSessions"></p><p> sessions.</p><br>

<style>
@media all { 
	#wp-admin-bar-updates { display: none }
	body {
	    font: normal 100% Open Sans,Helvetica,sans-serif;
	    background-color: #fff;
	    color: #000;
	    padding: .6em;
	    -webkit-font-smoothing: antialiased;
	}
	.container {
	    overflow: hidden;
	    padding: 0 1em;
	    max-width: 45em;
	    margin: auto;
	}
	/* blog title */
	h1 {
        font-family: acta-display, Georgia, Times, serif;
	    font-size: 3em;
	    color: #333;
	    font-weight: normal;
	    margin-top: 1em;
	    text-align: center;
	}

	img {
	    border: 0;
	    padding: 3px;
	}
	img a { border: 0 }
	p {
        display: inline;
	    line-height: 1.45em;
	    margin: .7em 0 0 0;
	    font-family: ff-meta-serif-web-pro, Georgia, Cambria, 'Times New Roman', Times, serif;
	    font-size: 1.3em;
	    color: #333;
	    -webkit-font-smoothing: antialiased;
	}
	a:link {
	    color: #333;
	    text-decoration: none;
	    border-width: 0;
	    border-style: none;
	}
	a:visited {
	    color: #333;
	    text-decoration: none;
	    border: 0;
	    border-width: 0;
	    border-style: none;
	}
	a:hover {
	    color: #999;
	    text-decoration: none;
	    border: 0;
	    border-width: 0;
	    border-style: none;
	}

    #amtOfTimesOn {
        color: rgb(0, 0, 0);
        font-weight: bold;
    }


    #totalRuntime {
        color: rgb(0, 0, 0);
        font-weight: bold;
    }


    #totalConnectionTime {
        color: rgb(0, 0, 0);
        font-weight: bold;
    }


    #totalActualTouchTime {
        color: rgb(0, 0, 0);
        font-weight: bold;
    }



    #totalTouches {
        color: rgb(0, 0, 0);
        font-weight: bold;
    }



    #totalSessions {
        color: rgb(0, 0, 0);
        font-weight: bold;
    }


}

</style>


</body>
</html>